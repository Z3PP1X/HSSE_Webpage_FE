<!-- form.component.html -->
<form (ngSubmit)="onSubmit()" [formGroup]="form" class="form-container">
  <!-- Form title -->
  <h2 class="form-title">{{formTitle()}}</h2>

  <!-- Horizontal stepper navigation -->
  <mat-horizontal-stepper linear #stepper class="clean-stepper">
    @for (category of formCategories(); track category) {
      <mat-step [label]="category" [completed]="isCategoryComplete(category)">
        <ng-template matStepLabel>{{ category }}</ng-template>
        <div class="step-content">
          <h3 class="category-title">{{category}}</h3>
          
          @if (form && form.get(category)) {
            @for (controlName of getControlKeys(category); track controlName) {
              <div class="form-field">
                @if (getQuestionForKey(category + '.' + controlName)) {
                  <app-form-question 
                    [question]="getQuestionForKey(category + '.' + controlName)!" 
                    [form]="form">
                  </app-form-question>
                } @else {
                  <div class="fallback-field">
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>{{controlName}}</mat-label>
                      <input matInput [formControlName]="controlName" [id]="controlName">
                    </mat-form-field>
                  </div>
                }
              </div>
            }
          }
          
          <!-- Step navigation buttons -->
          <div class="step-actions">
            <button 
              mat-button 
              *ngIf="stepper.selectedIndex !== 0" 
              (click)="stepper.previous()"
              color="primary">
              Previous
            </button>
            <button 
              mat-raised-button 
              *ngIf="stepper.selectedIndex !== formCategories().length - 1" 
              (click)="stepper.next()"
              color="primary">
              Next
            </button>
            <button 
              mat-raised-button 
              *ngIf="stepper.selectedIndex === formCategories().length - 1" 
              type="submit"
              color="primary">
              Submit
            </button>
          </div>
        </div>
      </mat-step>
    }
  </mat-horizontal-stepper>
</form>

